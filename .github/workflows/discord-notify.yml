name: Discord Notify on Update

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          AUTHOR="${{ github.event.head_commit.author.name }}"
          REPO="${{ github.repository }}"
          SITE="https://asukio-dev.github.io/valentine/"

          curl -H "Content-Type: application/json" \
          -d "{
            \"username\": \"Magical Park Bot\",
            \"content\": \"âœ¨ **Mise Ã  jour du site Valentine** âœ¨\nğŸ“¦ Repo: $REPO\nğŸ‘¤ Auteur: $AUTHOR\nğŸ“ Message: $COMMIT_MSG\nğŸŒ Voir le site: $SITE\"
          }" \
          $WEBHOOK
